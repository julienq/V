<svg xmlns="http://www.w3.org/2000/svg" viewBox="-200 -200 400 400"
  xmlns:xlink="http://www.w3.org/1999/xlink">
  <defs>
    <clipPath id="date-clip">
      <rect x="80" y="-24" width="56" height="48"/>
    </clipPath>
  </defs>
  <g id="n" fill="white" stroke="black" stroke-linecap="round">
    <circle r="180"/>
  </g>
  <rect x="80" y="-24" width="56" height="48" fill="none" stroke="black"
    rx="4" ry="4"/>
  <g clip-path="url(#date-clip)">
    <g transform="translate(290, 12)">
      <g id="days" stroke="black" font-size="36" text-anchor="end"
        font-family="Univers, 'Helvetica Neue', sans-serif"/>
    </g>
  </g>
  <g stroke-linecap="round" stroke="black" transform="rotate(-90)">
    <line x1="80" id="h"/>
    <line x1="160" id="m"/>
    <line x1="160" id="s" stroke="#ff4040"/>
  </g>
  <script xlink:href="../V.js"/>
  <script><![CDATA[

"use strict";

var h = document.getElementById("h");
var m = document.getElementById("m");
var s = document.getElementById("s");

var offset = (new Date()).getTimezoneOffset() / 60;

var n = document.getElementById("n");
for (var i = 0; i < 60; ++i) {
  n.appendChild(V.$line({ y1: 170, y2: i % 5 === 0 ? 150 : 160,
    transform: "rotate(%0)".fmt(i * 6) }));
}

var days = document.getElementById("days");

// TODO check day
// TODO update at midnight!

function set_days() {
  V.remove_children(days);
  var now = Date.now();
  var yesterday = new Date(now - 24 * 60 * 60 * 1000).getDate();
  var today = new Date().getDate();
  var tomorrow = new Date(now + 24 * 60 * 60 * 1000).getDate();
  [yesterday, today, tomorrow].forEach(function (d, i) {
    days.appendChild(V.$text({ x: -160,
      transform: "rotate(%0)".fmt((1 - i) * 360 / 31) }, d.toString()));
  });
}

function hands() {
  var d = Date.now();
  h.setAttribute("transform", "rotate(%0)"
    .fmt(((d / 3600000) % 24 - offset) * 30));
  m.setAttribute("transform", "rotate(%0)".fmt(((d / 60000) % 60) * 6));
  s.setAttribute("transform", "rotate(%0)".fmt(((d / 1000) % 60) * 6));
  var off = ((d / 3600000) % 24 - offset - 9) * 360 / (31 * 24);
  days.setAttribute("transform", "rotate(%0)".fmt(off));
  requestAnimationFrame(hands);
}

set_days();
hands();

  ]]></script>
</svg>

